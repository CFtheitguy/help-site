<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Submit a ticket • Linear Desk</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <style>
    body{margin:0;background:#0b1220;color:#e5e7eb;font:14px/1.45 system-ui,sans-serif}
    .wrap{max-width:720px;margin:48px auto;padding:0 16px}
    .card{background:#0f172a;border:1px solid #1f2937;border-radius:14px;padding:16px}
    h1{margin:0 0 12px}
    label{display:block;margin:10px 0 6px;color:#94a3b8}
    input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid #1f2937;background:#0b1730;color:#e5e7eb}
    button{background:#111827;color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
    button:hover{background:#1f2937}
    .muted{color:#94a3b8}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .hint{font-size:12px;color:#94a3b8;margin-top:4px}
  </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Submit a support request</h1>
    <label>Your name</label>
    <input id="name" placeholder="Jane Doe"/>

    <label>Your email</label>
    <input id="email" placeholder="you@example.com"/>

    <label>Subject</label>
    <input id="subject" placeholder="What do you need help with?"/>

    <label>Message</label>
    <textarea id="message" rows="6" placeholder="Describe the issue…"></textarea>

    <label>Priority (optional)</label>
    <select id="priority">
      <option value="">Normal (default)</option>
      <option>urgent</option>
      <option>low</option>
    </select>

    <label>Attachments (optional)</label>
    <input id="files" type="file" multiple/>
    <div class="hint">If applicable, please add a screenshot or photo so we can help you faster.</div>
    <div class="muted" id="filesInfo" style="margin-top:6px"></div>

    <div class="row" style="margin-top:12px">
      <button id="btnSend">Send</button>
      <span class="muted" id="status"></span>
    </div>
  </div>
</div>

<script>
const API = "https://api.help.linearit.co";
const $ = id => document.getElementById(id);

function human(n){if(!n)return"0 B";const u=['B','KB','MB','GB'];let i=0;while(n>=1024&&i<u.length-1){n/=1024;i++}return n.toFixed(i?1:0)+' '+u[i]}

$("files").addEventListener("change", ()=>{
  const fs = Array.from($("files").files||[]);
  const total = fs.reduce((a,f)=>a+(f.size||0),0);
  $("filesInfo").textContent = fs.length ? `${fs.length} file(s), total ${human(total)}` : "";
});

$("btnSend").onclick = async ()=>{
  const name = $("name").value.trim();
  const email = $("email").value.trim();
  const subject = $("subject").value.trim();
  const message = $("message").value.trim();
  const priority = $("priority").value.trim();

  if(!name || !email || !subject || !message){
    $("status").textContent = "Please fill in name, email, subject, and message.";
    return;
  }

  // Build multipart/form-data so we can include files
  const fd = new FormData();
  fd.append("name", name);
  fd.append("email", email);
  fd.append("subject", subject);
  fd.append("message", message);
  if (priority) fd.append("priority", priority);
  fd.append("honeypot", ""); // keep blank

  const fs = $("files").files;
  for (const f of fs) fd.append("files", f);

  $("btnSend").disabled = true;
  $("status").textContent = "Sending…";
  try{
    const r = await fetch(`${API}/`, { method:"POST", body: fd });
    const j = await r.json().catch(()=>({}));
    if(r.ok && j.ok){
      $("status").textContent = `Thanks! Ticket #${j.issue_number} was created.`;
      $("name").value = $("email").value = $("subject").value = $("message").value = "";
      $("priority").value = ""; $("files").value = ""; $("filesInfo").textContent = "";
    }else{
      $("status").textContent = `Error: ${j.error||("HTTP "+r.status)}`;
    }
  }catch{
    $("status").textContent = "Network error.";
  }finally{
    $("btnSend").disabled = false;
  }
};
</script>
</body>
</html>
